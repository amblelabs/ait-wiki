{{- $allFilePaths := partial "util/get-files-recursive.html" (dict "basePath" "src") -}}

{{- range $allFilePaths -}}
  {{- $filePath := . -}}
  {{- $fileExtension := path.Ext $filePath -}}

  {{- if eq $fileExtension ".yaml" -}}
    {{- $string := readFile $filePath -}}
    {{- $data := unmarshal $string -}}

    {{- $lastUpdated := (os.Stat $filePath).ModTime -}}
    {{- $renderedContent := partial "cms/render-file.html" (merge $data (dict "lastUpdated" $lastUpdated)) -}}

    {{- $dir := path.Dir $filePath -}}
    {{- $base := path.BaseName $filePath -}}
    {{- $outputFile := printf "%s/%s.md" $dir $base -}}

    {{- $resource := resources.FromString $outputFile $renderedContent -}} 
    {{- $file := $resource.RelPermalink -}} 
  {{- end -}}
{{- end -}}